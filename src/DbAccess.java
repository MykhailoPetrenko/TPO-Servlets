import java.io.*;import java.util.*;import javax.naming.*;import java.sql.*;import javax.sql.*;public class DbAccess extends CommandImpl {    private DataSource dataSource;    public void init() {        try {            Context initialContext = new InitialContext();            Context jndiContext = (Context) initialContext.lookup("java:comp/env");            String dbName = (String) getParameter("dbName");            dataSource = (DataSource) jndiContext.lookup(dbName);        } catch (NamingException exc) {            setStatusCode(1);        }    }    public void execute() {        clearResult();        setStatusCode(0);        String where = getWhere();        String sel = "SELECT  A.NAME, W.NAME, P.ISBN, P.TYTUL, P.ROK, P.CENA FROM AUTOR A JOIN POZYCJE P ON " +                "A.AUTID = P.AUTID JOIN WYDAWCA W ON W.WYDID = P.WYDID" + where;        Connection con = null;        try {            synchronized(this) {                con = dataSource.getConnection();            }            Statement stmt = con.createStatement();            ResultSet rs = stmt.executeQuery(sel);            ResultSetMetaData rsMeta = rs.getMetaData();            int ilColumn = rsMeta.getColumnCount();            while (rs.next())  {                String rezult = "";                for(int i=1; i<ilColumn; i++){                    rezult+= rs.getObject(i) + " ";                    addResult(rezult);                }            }            stmt.close();            con.close();        } catch (SQLException exc) {            setStatusCode(2);            throw new DbAccessException("Błąd w dostępie do bazy lub w SQL", exc);        } finally {            try {                con.close();            } catch (Exception exc) {}        }    }    public String getWhere(){        String ret= " WHERE ";        String author = (String) getParameter("author");        String publisher = (String) getParameter("publisher");        String ISBN = (String) getParameter("ISBN");        String title = (String) getParameter("title");        String year = (String) getParameter("year");        String price = (String) getParameter("price");        if (author != null && !author.isEmpty())            ret+="A.NAME ='" + author + "' ";        if (publisher != null && !publisher.isEmpty())            ret+="W.NAME ='" + publisher + "' ";        if (ISBN != null && !ISBN.isEmpty() )            ret+= "P.ISBN ='" + ISBN + "' ";        if (title != null && !title.isEmpty())            ret+= "P.TYTUL ='" + title + "' ";        if (year != null && !year.isEmpty())            ret+= "P.ROK ='" + year + "' ";        if (price != null && !price.isEmpty())            ret+= "P.CENA ='" + price + "' ";        return ret;    }}